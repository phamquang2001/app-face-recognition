{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\quang\\\\OneDrive\\\\Desktop\\\\TestProject\\\\my-app\\\\src\\\\Photo\\\\Photo.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { loadModels, getFullFaceDescription, createMatcher } from \"../api/face\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst testImg = require(\"../img/anhthe.jpg\");\nconst JSON_PROFILE = require(\"../descriptors/bnk48.json\");\nconst INIT_STATE = {\n  imageURL: testImg,\n  fullDesc: null,\n  detections: null,\n  descriptors: null,\n  match: null\n};\nfunction Photo(props) {\n  _s();\n  const [state, setState] = useState({\n    ...INIT_STATE,\n    faceMatcher: null,\n    loading: false\n  });\n  useEffect(() => {\n    initialize();\n  }, []);\n  async function initialize() {\n    await loadModels();\n    const faceMatcher = await createMatcher(JSON_PROFILE);\n    await handleImage(state.imageURL);\n    console.log();\n    setState(prevState => ({\n      ...prevState,\n      faceMatcher: faceMatcher\n    }));\n    await handleImage(state.imageURL);\n  }\n  const handleImage = async (image = state.imageURL) => {\n    const fullDesc = await getFullFaceDescription(image);\n    const faceMatcher = await createMatcher(JSON_PROFILE);\n    if (fullDesc && fullDesc.length > 0) {\n      setState(prevState => ({\n        ...prevState,\n        fullDesc: fullDesc,\n        detections: fullDesc.map(fd => fd.detection),\n        descriptors: fullDesc.map(fd => fd.descriptor),\n        faceMatcher: faceMatcher\n      }));\n    }\n    if (!!state.descriptors && !!state.faceMatcher) {\n      try {\n        const match = state.descriptors.map(descriptor => state.faceMatcher.findBestMatch(descriptor));\n        console.log(state);\n        setState(prevState => ({\n          ...prevState,\n          match: match,\n          faceMatcher: faceMatcher\n        }));\n      } catch {\n        console.log('error');\n      }\n    }\n  };\n  const handleFileChange = async event => {\n    resetState();\n    const imageURL = URL.createObjectURL(event.target.files[0]);\n    setState(prevState => ({\n      ...prevState,\n      imageURL,\n      loading: true\n    }));\n    handleImage();\n  };\n  const resetState = () => {\n    setState(INIT_STATE);\n  };\n  const {\n    imageURL,\n    detections,\n    match\n  } = state;\n  let drawBox = null;\n  if (detections && detections.length > 0) {\n    drawBox = detections.map((detection, i) => {\n      const _H = detection.box.height;\n      const _W = detection.box.width;\n      const _X = detection.box._x;\n      const _Y = detection.box._y;\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: \"absolute\",\n            border: \"solid\",\n            borderColor: \"blue\",\n            height: _H,\n            width: _W,\n            transform: `translate(${_X}px,${_Y}px)`\n          },\n          children: match && match[i] ? /*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              backgroundColor: \"blue\",\n              border: \"solid\",\n              borderColor: \"blue\",\n              width: _W,\n              marginTop: 0,\n              color: \"#fff\",\n              transform: `translate(-3px,${_H}px)`\n            },\n            children: match[i]._label\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 15\n          }, this) : null\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 11\n        }, this)\n      }, i, false, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 9\n      }, this);\n    });\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"input\", {\n      id: \"myFileUpload\",\n      type: \"file\",\n      onChange: handleFileChange,\n      accept: \".jpg, .jpeg, .png\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: \"relative\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: \"absolute\"\n        },\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: state.imageURL,\n          alt: \"imageURL\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 9\n      }, this), drawBox ? drawBox : null]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 120,\n    columnNumber: 5\n  }, this);\n}\n_s(Photo, \"4h3W7uUFYNa4dNOm+FthuJP59OM=\");\n_c = Photo;\nexport default Photo;\nvar _c;\n$RefreshReg$(_c, \"Photo\");","map":{"version":3,"names":["React","useState","useEffect","withRouter","loadModels","getFullFaceDescription","createMatcher","jsxDEV","_jsxDEV","testImg","require","JSON_PROFILE","INIT_STATE","imageURL","fullDesc","detections","descriptors","match","Photo","props","_s","state","setState","faceMatcher","loading","initialize","handleImage","console","log","prevState","image","length","map","fd","detection","descriptor","findBestMatch","handleFileChange","event","resetState","URL","createObjectURL","target","files","drawBox","i","_H","box","height","_W","width","_X","_x","_Y","_y","children","style","position","border","borderColor","transform","backgroundColor","marginTop","color","_label","fileName","_jsxFileName","lineNumber","columnNumber","id","type","onChange","accept","src","alt","_c","$RefreshReg$"],"sources":["C:/Users/quang/OneDrive/Desktop/TestProject/my-app/src/Photo/Photo.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { withRouter } from \"react-router-dom\";\r\nimport { loadModels, getFullFaceDescription, createMatcher } from \"../api/face\";\r\n\r\nconst testImg = require(\"../img/anhthe.jpg\");\r\nconst JSON_PROFILE = require(\"../descriptors/bnk48.json\");\r\n\r\nconst INIT_STATE = {\r\n  imageURL: testImg,\r\n  fullDesc: null,\r\n  detections: null,\r\n  descriptors: null,\r\n  match: null,\r\n};\r\n\r\nfunction Photo(props) {\r\n  const [state, setState] = useState({\r\n    ...INIT_STATE,\r\n    faceMatcher: null,\r\n    loading: false,\r\n  });\r\n  useEffect(() => {\r\n    initialize();\r\n  }, []);\r\n\r\n  async function initialize() {\r\n    await loadModels();\r\n    const faceMatcher = await createMatcher(JSON_PROFILE);\r\n    await handleImage(state.imageURL);\r\n    console.log()\r\n    setState((prevState) => ({\r\n      ...prevState,\r\n      faceMatcher: faceMatcher,\r\n    }));\r\n    await handleImage(state.imageURL);\r\n  }\r\n\r\n  const handleImage = async (image = state.imageURL) => {\r\n    const fullDesc = await getFullFaceDescription(image);\r\n    const faceMatcher = await createMatcher(JSON_PROFILE);\r\n    if (fullDesc && fullDesc.length > 0) {\r\n      setState((prevState) => ({\r\n        ...prevState,\r\n        fullDesc: fullDesc,\r\n        detections: fullDesc.map((fd) => fd.detection),\r\n        descriptors: fullDesc.map((fd) => fd.descriptor),\r\n        faceMatcher: faceMatcher\r\n      }));\r\n    }\r\n\r\n    if (!!state.descriptors && !!state.faceMatcher) {\r\n      try{\r\n        const match = state.descriptors.map((descriptor) =>\r\n          state.faceMatcher.findBestMatch(descriptor)\r\n        );\r\n        console.log(state)\r\n        setState((prevState) => ({ ...prevState,match: match,  faceMatcher: faceMatcher }));\r\n      }\r\n      catch{\r\n        console.log('error');\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleFileChange = async (event) => {\r\n    resetState();\r\n    const imageURL = URL.createObjectURL(event.target.files[0]);\r\n    setState((prevState) => ({ ...prevState, imageURL, loading: true }));\r\n    handleImage();\r\n  };\r\n\r\n  const resetState = () => {\r\n    setState(INIT_STATE);\r\n  };\r\n\r\n  const { imageURL, detections, match } = state;\r\n\r\n  let drawBox = null;\r\n  if (detections && detections.length > 0) {\r\n    drawBox = detections.map((detection, i) => {\r\n      const _H = detection.box.height;\r\n      const _W = detection.box.width;\r\n      const _X = detection.box._x;\r\n      const _Y = detection.box._y;\r\n\r\n      return (\r\n        <div key={i}>\r\n          <div\r\n            style={{\r\n              position: \"absolute\",\r\n              border: \"solid\",\r\n              borderColor: \"blue\",\r\n              height: _H,\r\n              width: _W,\r\n              transform: `translate(${_X}px,${_Y}px)`,\r\n            }}\r\n          >\r\n            {match && match[i] ? (\r\n              <p\r\n                style={{\r\n                  backgroundColor: \"blue\",\r\n                  border: \"solid\",\r\n                  borderColor: \"blue\",\r\n                  width: _W,\r\n                  marginTop: 0,\r\n                  color: \"#fff\",\r\n                  transform: `translate(-3px,${_H}px)`,\r\n                }}\r\n              >\r\n                {match[i]._label}\r\n              </p>\r\n            ) : null}\r\n          </div>\r\n        </div>\r\n      );\r\n    });\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <input\r\n        id=\"myFileUpload\"\r\n        type=\"file\"\r\n        onChange={handleFileChange}\r\n        accept=\".jpg, .jpeg, .png\"\r\n      />\r\n      <div style={{ position: \"relative\" }}>\r\n        <div style={{ position: \"absolute\" }}>\r\n          <img src={state.imageURL} alt=\"imageURL\" />\r\n        </div>\r\n        {drawBox ? drawBox : null}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Photo"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAClD,SAASC,UAAU,QAAQ,kBAAkB;AAC7C,SAASC,UAAU,EAAEC,sBAAsB,EAAEC,aAAa,QAAQ,aAAa;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEhF,MAAMC,OAAO,GAAGC,OAAO,CAAC,mBAAmB,CAAC;AAC5C,MAAMC,YAAY,GAAGD,OAAO,CAAC,2BAA2B,CAAC;AAEzD,MAAME,UAAU,GAAG;EACjBC,QAAQ,EAAEJ,OAAO;EACjBK,QAAQ,EAAE,IAAI;EACdC,UAAU,EAAE,IAAI;EAChBC,WAAW,EAAE,IAAI;EACjBC,KAAK,EAAE;AACT,CAAC;AAED,SAASC,KAAKA,CAACC,KAAK,EAAE;EAAAC,EAAA;EACpB,MAAM,CAACC,KAAK,EAAEC,QAAQ,CAAC,GAAGrB,QAAQ,CAAC;IACjC,GAAGW,UAAU;IACbW,WAAW,EAAE,IAAI;IACjBC,OAAO,EAAE;EACX,CAAC,CAAC;EACFtB,SAAS,CAAC,MAAM;IACduB,UAAU,CAAC,CAAC;EACd,CAAC,EAAE,EAAE,CAAC;EAEN,eAAeA,UAAUA,CAAA,EAAG;IAC1B,MAAMrB,UAAU,CAAC,CAAC;IAClB,MAAMmB,WAAW,GAAG,MAAMjB,aAAa,CAACK,YAAY,CAAC;IACrD,MAAMe,WAAW,CAACL,KAAK,CAACR,QAAQ,CAAC;IACjCc,OAAO,CAACC,GAAG,CAAC,CAAC;IACbN,QAAQ,CAAEO,SAAS,KAAM;MACvB,GAAGA,SAAS;MACZN,WAAW,EAAEA;IACf,CAAC,CAAC,CAAC;IACH,MAAMG,WAAW,CAACL,KAAK,CAACR,QAAQ,CAAC;EACnC;EAEA,MAAMa,WAAW,GAAG,MAAAA,CAAOI,KAAK,GAAGT,KAAK,CAACR,QAAQ,KAAK;IACpD,MAAMC,QAAQ,GAAG,MAAMT,sBAAsB,CAACyB,KAAK,CAAC;IACpD,MAAMP,WAAW,GAAG,MAAMjB,aAAa,CAACK,YAAY,CAAC;IACrD,IAAIG,QAAQ,IAAIA,QAAQ,CAACiB,MAAM,GAAG,CAAC,EAAE;MACnCT,QAAQ,CAAEO,SAAS,KAAM;QACvB,GAAGA,SAAS;QACZf,QAAQ,EAAEA,QAAQ;QAClBC,UAAU,EAAED,QAAQ,CAACkB,GAAG,CAAEC,EAAE,IAAKA,EAAE,CAACC,SAAS,CAAC;QAC9ClB,WAAW,EAAEF,QAAQ,CAACkB,GAAG,CAAEC,EAAE,IAAKA,EAAE,CAACE,UAAU,CAAC;QAChDZ,WAAW,EAAEA;MACf,CAAC,CAAC,CAAC;IACL;IAEA,IAAI,CAAC,CAACF,KAAK,CAACL,WAAW,IAAI,CAAC,CAACK,KAAK,CAACE,WAAW,EAAE;MAC9C,IAAG;QACD,MAAMN,KAAK,GAAGI,KAAK,CAACL,WAAW,CAACgB,GAAG,CAAEG,UAAU,IAC7Cd,KAAK,CAACE,WAAW,CAACa,aAAa,CAACD,UAAU,CAC5C,CAAC;QACDR,OAAO,CAACC,GAAG,CAACP,KAAK,CAAC;QAClBC,QAAQ,CAAEO,SAAS,KAAM;UAAE,GAAGA,SAAS;UAACZ,KAAK,EAAEA,KAAK;UAAGM,WAAW,EAAEA;QAAY,CAAC,CAAC,CAAC;MACrF,CAAC,CACD,MAAK;QACHI,OAAO,CAACC,GAAG,CAAC,OAAO,CAAC;MACtB;IACF;EACF,CAAC;EAED,MAAMS,gBAAgB,GAAG,MAAOC,KAAK,IAAK;IACxCC,UAAU,CAAC,CAAC;IACZ,MAAM1B,QAAQ,GAAG2B,GAAG,CAACC,eAAe,CAACH,KAAK,CAACI,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC,CAAC;IAC3DrB,QAAQ,CAAEO,SAAS,KAAM;MAAE,GAAGA,SAAS;MAAEhB,QAAQ;MAAEW,OAAO,EAAE;IAAK,CAAC,CAAC,CAAC;IACpEE,WAAW,CAAC,CAAC;EACf,CAAC;EAED,MAAMa,UAAU,GAAGA,CAAA,KAAM;IACvBjB,QAAQ,CAACV,UAAU,CAAC;EACtB,CAAC;EAED,MAAM;IAAEC,QAAQ;IAAEE,UAAU;IAAEE;EAAM,CAAC,GAAGI,KAAK;EAE7C,IAAIuB,OAAO,GAAG,IAAI;EAClB,IAAI7B,UAAU,IAAIA,UAAU,CAACgB,MAAM,GAAG,CAAC,EAAE;IACvCa,OAAO,GAAG7B,UAAU,CAACiB,GAAG,CAAC,CAACE,SAAS,EAAEW,CAAC,KAAK;MACzC,MAAMC,EAAE,GAAGZ,SAAS,CAACa,GAAG,CAACC,MAAM;MAC/B,MAAMC,EAAE,GAAGf,SAAS,CAACa,GAAG,CAACG,KAAK;MAC9B,MAAMC,EAAE,GAAGjB,SAAS,CAACa,GAAG,CAACK,EAAE;MAC3B,MAAMC,EAAE,GAAGnB,SAAS,CAACa,GAAG,CAACO,EAAE;MAE3B,oBACE9C,OAAA;QAAA+C,QAAA,eACE/C,OAAA;UACEgD,KAAK,EAAE;YACLC,QAAQ,EAAE,UAAU;YACpBC,MAAM,EAAE,OAAO;YACfC,WAAW,EAAE,MAAM;YACnBX,MAAM,EAAEF,EAAE;YACVI,KAAK,EAAED,EAAE;YACTW,SAAS,EAAG,aAAYT,EAAG,MAAKE,EAAG;UACrC,CAAE;UAAAE,QAAA,EAEDtC,KAAK,IAAIA,KAAK,CAAC4B,CAAC,CAAC,gBAChBrC,OAAA;YACEgD,KAAK,EAAE;cACLK,eAAe,EAAE,MAAM;cACvBH,MAAM,EAAE,OAAO;cACfC,WAAW,EAAE,MAAM;cACnBT,KAAK,EAAED,EAAE;cACTa,SAAS,EAAE,CAAC;cACZC,KAAK,EAAE,MAAM;cACbH,SAAS,EAAG,kBAAiBd,EAAG;YAClC,CAAE;YAAAS,QAAA,EAEDtC,KAAK,CAAC4B,CAAC,CAAC,CAACmB;UAAM;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACf,CAAC,GACF;QAAI;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACL;MAAC,GA1BEvB,CAAC;QAAAoB,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OA2BN,CAAC;IAEV,CAAC,CAAC;EACJ;EAEA,oBACE5D,OAAA;IAAA+C,QAAA,gBACE/C,OAAA;MACE6D,EAAE,EAAC,cAAc;MACjBC,IAAI,EAAC,MAAM;MACXC,QAAQ,EAAElC,gBAAiB;MAC3BmC,MAAM,EAAC;IAAmB;MAAAP,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC3B,CAAC,eACF5D,OAAA;MAAKgD,KAAK,EAAE;QAAEC,QAAQ,EAAE;MAAW,CAAE;MAAAF,QAAA,gBACnC/C,OAAA;QAAKgD,KAAK,EAAE;UAAEC,QAAQ,EAAE;QAAW,CAAE;QAAAF,QAAA,eACnC/C,OAAA;UAAKiE,GAAG,EAAEpD,KAAK,CAACR,QAAS;UAAC6D,GAAG,EAAC;QAAU;UAAAT,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACxC,CAAC,EACLxB,OAAO,GAAGA,OAAO,GAAG,IAAI;IAAA;MAAAqB,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACtB,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV;AAAChD,EAAA,CAvHQF,KAAK;AAAAyD,EAAA,GAALzD,KAAK;AAyHd,eAAeA,KAAK;AAAA,IAAAyD,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}