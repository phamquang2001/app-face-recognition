{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\quang\\\\OneDrive\\\\Desktop\\\\TestProject\\\\my-app\\\\src\\\\Video\\\\VideoInput.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport Webcam from 'react-webcam';\nimport { loadModels, getFullFaceDescription, createMatcher } from '../api/face';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst JSON_PROFILE = require('../descriptors/bnk48.json');\nconst WIDTH = 420;\nconst HEIGHT = 420;\nconst inputSize = 160;\nconst VideoInput = () => {\n  _s();\n  const webcamRef = useRef(null);\n  const [fullDesc, setFullDesc] = useState(null);\n  const [detections, setDetections] = useState(null);\n  const [descriptors, setDescriptors] = useState(null);\n  const [faceMatcher, setFaceMatcher] = useState(null);\n  const [match, setMatch] = useState(null);\n  const [facingMode, setFacingMode] = useState(null);\n  let interval;\n  useEffect(() => {\n    const initialize = async () => {\n      await loadModels();\n      setFaceMatcher(await createMatcher(JSON_PROFILE));\n      setInputDevice();\n    };\n    initialize();\n  }, []);\n  useEffect(() => {\n    startCapture();\n    return () => clearInterval(interval);\n  }, [facingMode]);\n  const setInputDevice = () => {\n    navigator.mediaDevices.enumerateDevices().then(async devices => {\n      const inputDevice = await devices.filter(device => device.kind === 'videoinput');\n      if (inputDevice.length < 2) {\n        setFacingMode('user');\n      } else {\n        setFacingMode({\n          exact: 'environment'\n        });\n      }\n    });\n  };\n  const startCapture = () => {\n    interval = setInterval(() => {\n      capture();\n    }, 1000);\n  };\n  const capture = async () => {\n    if (webcamRef.current) {\n      const screenshot = webcamRef.current.getScreenshot();\n      const fullFaceDesc = await getFullFaceDescription(screenshot, inputSize);\n      if (fullFaceDesc) {\n        setDetections(fullFaceDesc.map(fd => fd.detection));\n        setDescriptors(fullFaceDesc.map(fd => fd.descriptor));\n      }\n      if (descriptors && faceMatcher) {\n        const matchResults = descriptors.map(descriptor => faceMatcher.findBestMatch(descriptor));\n        setMatch(matchResults);\n      }\n    }\n  };\n  let videoConstraints = null;\n  let camera = '';\n  if (facingMode) {\n    videoConstraints = {\n      width: WIDTH,\n      height: HEIGHT,\n      facingMode: facingMode\n    };\n    camera = facingMode === 'user' ? 'Front' : 'Back';\n  }\n  let drawBox = null;\n  if (detections) {\n    drawBox = detections.map((detection, i) => {\n      const _H = detection.box.height;\n      const _W = detection.box.width;\n      const _X = detection.box._x;\n      const _Y = detection.box._y;\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: 'absolute',\n            border: 'solid',\n            borderColor: 'blue',\n            height: _H,\n            width: _W,\n            transform: `translate(${_X}px,${_Y}px)`\n          },\n          children: match && match[i] ? /*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              backgroundColor: 'blue',\n              border: 'solid',\n              borderColor: 'blue',\n              width: _W,\n              marginTop: 0,\n              color: '#fff',\n              transform: `translate(-3px,${_H}px)`\n            },\n            children: match[i]._label\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 104,\n            columnNumber: 15\n          }, this) : null\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 11\n        }, this)\n      }, i, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 9\n      }, this);\n    });\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"Camera\",\n    style: {\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'center'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Camera: \", camera]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        width: WIDTH,\n        height: HEIGHT\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'relative',\n          width: WIDTH\n        },\n        children: [videoConstraints ? /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: 'absolute'\n          },\n          children: /*#__PURE__*/_jsxDEV(Webcam, {\n            audio: false,\n            width: WIDTH,\n            height: HEIGHT,\n            ref: webcamRef,\n            screenshotFormat: \"image/jpeg\",\n            videoConstraints: videoConstraints\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 143,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 13\n        }, this) : null, drawBox ? drawBox : null]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 125,\n    columnNumber: 5\n  }, this);\n};\n_s(VideoInput, \"ebmVW3Mj2VVhq2YUYvJkcT1oVCk=\");\n_c = VideoInput;\nexport default VideoInput;\nvar _c;\n$RefreshReg$(_c, \"VideoInput\");","map":{"version":3,"names":["React","useState","useEffect","useRef","Webcam","loadModels","getFullFaceDescription","createMatcher","jsxDEV","_jsxDEV","JSON_PROFILE","require","WIDTH","HEIGHT","inputSize","VideoInput","_s","webcamRef","fullDesc","setFullDesc","detections","setDetections","descriptors","setDescriptors","faceMatcher","setFaceMatcher","match","setMatch","facingMode","setFacingMode","interval","initialize","setInputDevice","startCapture","clearInterval","navigator","mediaDevices","enumerateDevices","then","devices","inputDevice","filter","device","kind","length","exact","setInterval","capture","current","screenshot","getScreenshot","fullFaceDesc","map","fd","detection","descriptor","matchResults","findBestMatch","videoConstraints","camera","width","height","drawBox","i","_H","box","_W","_X","_x","_Y","_y","children","style","position","border","borderColor","transform","backgroundColor","marginTop","color","_label","fileName","_jsxFileName","lineNumber","columnNumber","className","display","flexDirection","alignItems","audio","ref","screenshotFormat","_c","$RefreshReg$"],"sources":["C:/Users/quang/OneDrive/Desktop/TestProject/my-app/src/Video/VideoInput.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport Webcam from 'react-webcam';\r\nimport { loadModels, getFullFaceDescription, createMatcher } from '../api/face';\r\n\r\nconst JSON_PROFILE = require('../descriptors/bnk48.json');\r\n\r\nconst WIDTH = 420;\r\nconst HEIGHT = 420;\r\nconst inputSize = 160;\r\n\r\nconst VideoInput = () => {\r\n  const webcamRef = useRef(null);\r\n  const [fullDesc, setFullDesc] = useState(null);\r\n  const [detections, setDetections] = useState(null);\r\n  const [descriptors, setDescriptors] = useState(null);\r\n  const [faceMatcher, setFaceMatcher] = useState(null);\r\n  const [match, setMatch] = useState(null);\r\n  const [facingMode, setFacingMode] = useState(null);\r\n  let interval\r\n  useEffect(() => {\r\n    const initialize = async () => {\r\n      await loadModels();\r\n      setFaceMatcher(await createMatcher(JSON_PROFILE));\r\n      setInputDevice();\r\n    };\r\n    initialize();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    startCapture();\r\n    return () => clearInterval(interval);\r\n  }, [facingMode]);\r\n\r\n  const setInputDevice = () => {\r\n    navigator.mediaDevices.enumerateDevices().then(async devices => {\r\n      const inputDevice = await devices.filter(device => device.kind === 'videoinput');\r\n      if (inputDevice.length < 2) {\r\n        setFacingMode('user');\r\n      } else {\r\n        setFacingMode({ exact: 'environment' });\r\n      }\r\n    });\r\n  };\r\n\r\n  const startCapture = () => {\r\n    interval = setInterval(() => {\r\n      capture();\r\n    }, 1000);\r\n  };\r\n\r\n  const capture = async () => {\r\n    if (webcamRef.current) {\r\n      const screenshot = webcamRef.current.getScreenshot();\r\n      const fullFaceDesc = await getFullFaceDescription(screenshot, inputSize);\r\n\r\n      if (fullFaceDesc) {\r\n        setDetections(fullFaceDesc.map(fd => fd.detection));\r\n        setDescriptors(fullFaceDesc.map(fd => fd.descriptor));\r\n      }\r\n\r\n      if (descriptors && faceMatcher) {\r\n        const matchResults = descriptors.map(descriptor =>\r\n          faceMatcher.findBestMatch(descriptor)\r\n        );\r\n        setMatch(matchResults);\r\n      }\r\n    }\r\n  };\r\n\r\n  let videoConstraints = null;\r\n  let camera = '';\r\n\r\n  if (facingMode) {\r\n    videoConstraints = {\r\n      width: WIDTH,\r\n      height: HEIGHT,\r\n      facingMode: facingMode,\r\n    };\r\n    camera = facingMode === 'user' ? 'Front' : 'Back';\r\n  }\r\n\r\n  let drawBox = null;\r\n\r\n  if (detections) {\r\n    drawBox = detections.map((detection, i) => {\r\n      const _H = detection.box.height;\r\n      const _W = detection.box.width;\r\n      const _X = detection.box._x;\r\n      const _Y = detection.box._y;\r\n\r\n      return (\r\n        <div key={i}>\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              border: 'solid',\r\n              borderColor: 'blue',\r\n              height: _H,\r\n              width: _W,\r\n              transform: `translate(${_X}px,${_Y}px)`,\r\n            }}\r\n          >\r\n            {match && match[i] ? (\r\n              <p\r\n                style={{\r\n                  backgroundColor: 'blue',\r\n                  border: 'solid',\r\n                  borderColor: 'blue',\r\n                  width: _W,\r\n                  marginTop: 0,\r\n                  color: '#fff',\r\n                  transform: `translate(-3px,${_H}px)`,\r\n                }}\r\n              >\r\n                {match[i]._label}\r\n              </p>\r\n            ) : null}\r\n          </div>\r\n        </div>\r\n      );\r\n    });\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className=\"Camera\"\r\n      style={{\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        alignItems: 'center',\r\n      }}\r\n    >\r\n      <p>Camera: {camera}</p>\r\n      <div\r\n        style={{\r\n          width: WIDTH,\r\n          height: HEIGHT,\r\n        }}\r\n      >\r\n        <div style={{ position: 'relative', width: WIDTH }}>\r\n          {videoConstraints ? (\r\n            <div style={{ position: 'absolute' }}>\r\n              <Webcam\r\n                audio={false}\r\n                width={WIDTH}\r\n                height={HEIGHT}\r\n                ref={webcamRef}\r\n                screenshotFormat=\"image/jpeg\"\r\n                videoConstraints={videoConstraints}\r\n              />\r\n            </div>\r\n          ) : null}\r\n          {drawBox ? drawBox : null}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VideoInput\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}