{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\quang\\\\OneDrive\\\\Desktop\\\\TestProject\\\\my-app\\\\src\\\\Photo\\\\Photo.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { loadModels, getFullFaceDescription, createMatcher } from \"../api/face\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst testImg = require(\"../img/anhthe.\");\nconst JSON_PROFILE = require(\"../descriptors/bnk48.json\");\nconst INIT_STATE = {\n  imageURL: testImg,\n  fullDesc: null,\n  detections: null,\n  descriptors: null,\n  match: null\n};\nfunction Photo(props) {\n  _s();\n  const [state, setState] = useState({\n    ...INIT_STATE,\n    faceMatcher: null,\n    loading: false\n  });\n  let temp = INIT_STATE;\n  useEffect(() => {\n    initialize();\n  }, temp.imageURL);\n  async function initialize() {\n    await loadModels();\n    const faceMatcher = await createMatcher(JSON_PROFILE);\n    temp = {\n      imageURL: temp.imageURL,\n      fullDesc: temp.fullDesc,\n      detections: temp.detections,\n      descriptors: temp.descriptor,\n      match: temp.match,\n      faceMatcher: faceMatcher,\n      loading: true\n    };\n    await handleImage(temp.imageURL);\n  }\n  async function handleImage(image = temp.imageURL) {\n    const fullDesc = await getFullFaceDescription(image);\n    const faceMatcher = await createMatcher(JSON_PROFILE);\n    if (fullDesc && fullDesc.length > 0) {\n      temp = {\n        imageURL: temp.imageURL,\n        fullDesc: fullDesc,\n        detections: fullDesc.map(fd => fd.detection),\n        descriptors: fullDesc.map(fd => fd.descriptor),\n        match: temp.match,\n        faceMatcher: faceMatcher,\n        loading: true\n      };\n    }\n    if (!!temp.descriptors && !!temp.faceMatcher) {\n      const match = await temp.descriptors.map(descriptor => temp.faceMatcher.findBestMatch(descriptor));\n      temp = {\n        imageURL: temp.imageURL,\n        fullDesc: fullDesc,\n        detections: fullDesc.map(fd => fd.detection),\n        descriptors: fullDesc.map(fd => fd.descriptor),\n        match: temp.match,\n        faceMatcher: faceMatcher,\n        match: match,\n        loading: true\n      };\n      setState(temp);\n    }\n  }\n  async function handleFileChange(event) {\n    resetState();\n    const imageURL = URL.createObjectURL(event.target.files[0]);\n    temp = {\n      imageURL: imageURL,\n      loading: false\n    };\n    setState(temp);\n    handleImage();\n  }\n  function resetState() {\n    temp = {\n      INIT_STATE\n    };\n  }\n  const {\n    imageURL,\n    detections,\n    match\n  } = state;\n  let drawBox = null;\n  if (detections && detections.length > 0) {\n    drawBox = detections.map((detection, i) => {\n      const _H = detection.box.height;\n      const _W = detection.box.width;\n      const _X = detection.box._x;\n      const _Y = detection.box._y;\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: \"absolute\",\n            border: \"solid\",\n            borderColor: \"blue\",\n            height: _H,\n            width: _W,\n            transform: `translate(${_X}px,${_Y}px)`\n          },\n          children: match && match[i] ? /*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              backgroundColor: \"blue\",\n              border: \"solid\",\n              borderColor: \"blue\",\n              width: _W,\n              marginTop: 0,\n              color: \"#fff\",\n              transform: `translate(-3px,${_H}px)`\n            },\n            children: match[i]._label\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 120,\n            columnNumber: 15\n          }, this) : null\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 11\n        }, this)\n      }, i, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 9\n      }, this);\n    });\n  }\n  console.log(state);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"input\", {\n      id: \"myFileUpload\",\n      type: \"file\",\n      onChange: handleFileChange,\n      accept: \".jpg, .jpeg, .png\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: \"relative\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: \"absolute\"\n        },\n        children: state.loading === true ? /*#__PURE__*/_jsxDEV(\"img\", {\n          src: state.imageURL,\n          alt: \"imageURL\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 13\n        }, this) : \"Loading\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 9\n      }, this), drawBox ? drawBox : null]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 143,\n    columnNumber: 5\n  }, this);\n}\n_s(Photo, \"4h3W7uUFYNa4dNOm+FthuJP59OM=\");\n_c = Photo;\nexport default Photo;\nvar _c;\n$RefreshReg$(_c, \"Photo\");","map":{"version":3,"names":["React","useState","useEffect","withRouter","loadModels","getFullFaceDescription","createMatcher","jsxDEV","_jsxDEV","testImg","require","JSON_PROFILE","INIT_STATE","imageURL","fullDesc","detections","descriptors","match","Photo","props","_s","state","setState","faceMatcher","loading","temp","initialize","descriptor","handleImage","image","length","map","fd","detection","findBestMatch","handleFileChange","event","resetState","URL","createObjectURL","target","files","drawBox","i","_H","box","height","_W","width","_X","_x","_Y","_y","children","style","position","border","borderColor","transform","backgroundColor","marginTop","color","_label","fileName","_jsxFileName","lineNumber","columnNumber","console","log","id","type","onChange","accept","src","alt","_c","$RefreshReg$"],"sources":["C:/Users/quang/OneDrive/Desktop/TestProject/my-app/src/Photo/Photo.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { withRouter } from \"react-router-dom\";\r\nimport { loadModels, getFullFaceDescription, createMatcher } from \"../api/face\";\r\n\r\nconst testImg = require(\"../img/anhthe.\");\r\nconst JSON_PROFILE = require(\"../descriptors/bnk48.json\");\r\n\r\nconst INIT_STATE = {\r\n  imageURL: testImg,\r\n  fullDesc: null,\r\n  detections: null,\r\n  descriptors: null,\r\n  match: null,\r\n};\r\n\r\nfunction Photo(props) {\r\n  const [state, setState] = useState({\r\n    ...INIT_STATE,\r\n    faceMatcher: null,\r\n    loading: false,\r\n  });\r\n  let temp = INIT_STATE;\r\n\r\n  useEffect(() => {\r\n    initialize();\r\n  }, temp.imageURL);\r\n\r\n  async function initialize() {\r\n    await loadModels();\r\n    const faceMatcher = await createMatcher(JSON_PROFILE);\r\n    temp = {\r\n      imageURL: temp.imageURL,\r\n      fullDesc: temp.fullDesc,\r\n      detections: temp.detections,\r\n      descriptors: temp.descriptor,\r\n      match: temp.match,\r\n      faceMatcher: faceMatcher,\r\n      loading: true,\r\n    };\r\n\r\n    await handleImage(temp.imageURL);\r\n  }\r\n\r\n  async function handleImage(image = temp.imageURL) {\r\n    const fullDesc = await getFullFaceDescription(image);\r\n    const faceMatcher = await createMatcher(JSON_PROFILE);\r\n\r\n    if (fullDesc && fullDesc.length > 0) {\r\n      temp = {\r\n        imageURL: temp.imageURL,\r\n        fullDesc: fullDesc,\r\n        detections: fullDesc.map((fd) => fd.detection),\r\n        descriptors: fullDesc.map((fd) => fd.descriptor),\r\n        match: temp.match,\r\n        faceMatcher: faceMatcher,\r\n        loading: true,\r\n      };\r\n    }\r\n\r\n    if (!!temp.descriptors && !!temp.faceMatcher) {\r\n      const match = await temp.descriptors.map((descriptor) =>\r\n        temp.faceMatcher.findBestMatch(descriptor)\r\n      );\r\n\r\n      temp = {\r\n        imageURL: temp.imageURL,\r\n        fullDesc: fullDesc,\r\n        detections: fullDesc.map((fd) => fd.detection),\r\n        descriptors: fullDesc.map((fd) => fd.descriptor),\r\n        match: temp.match,\r\n        faceMatcher: faceMatcher,\r\n        match: match,\r\n        loading: true,\r\n      };\r\n      setState(temp);\r\n      \r\n    }\r\n  }\r\n\r\n  async function handleFileChange(event) {\r\n    resetState();\r\n    const imageURL = URL.createObjectURL(event.target.files[0]);\r\n    temp = {\r\n      imageURL: imageURL,\r\n      loading: false,\r\n    };\r\n\r\n    setState(temp);\r\n    \r\n    handleImage();\r\n  }\r\n\r\n  function resetState() {\r\n    temp = { INIT_STATE };\r\n  }\r\n\r\n  const { imageURL, detections, match } = state;\r\n\r\n  let drawBox = null;\r\n  if (detections && detections.length > 0) {\r\n    drawBox = detections.map((detection, i) => {\r\n      const _H = detection.box.height;\r\n      const _W = detection.box.width;\r\n      const _X = detection.box._x;\r\n      const _Y = detection.box._y;\r\n\r\n      return (\r\n        <div key={i}>\r\n          <div\r\n            style={{\r\n              position: \"absolute\",\r\n              border: \"solid\",\r\n              borderColor: \"blue\",\r\n              height: _H,\r\n              width: _W,\r\n              transform: `translate(${_X}px,${_Y}px)`,\r\n            }}\r\n          >\r\n            {match && match[i] ? (\r\n              <p\r\n                style={{\r\n                  backgroundColor: \"blue\",\r\n                  border: \"solid\",\r\n                  borderColor: \"blue\",\r\n                  width: _W,\r\n                  marginTop: 0,\r\n                  color: \"#fff\",\r\n                  transform: `translate(-3px,${_H}px)`,\r\n                }}\r\n              >\r\n                {match[i]._label}\r\n              </p>\r\n            ) : null}\r\n          </div>\r\n        </div>\r\n      );\r\n    });\r\n  }\r\n\r\n  console.log(state);\r\n\r\n  return (\r\n    <div>\r\n      <input\r\n        id=\"myFileUpload\"\r\n        type=\"file\"\r\n        onChange={handleFileChange}\r\n        accept=\".jpg, .jpeg, .png\"\r\n      />\r\n      <div style={{ position: \"relative\" }}>\r\n        <div style={{ position: \"absolute\" }}>\r\n          {state.loading === true ? (\r\n            <img src={state.imageURL} alt=\"imageURL\" />\r\n          ) : (\r\n            \"Loading\"\r\n          )}\r\n        </div>\r\n        {drawBox ? drawBox : null}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Photo;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}